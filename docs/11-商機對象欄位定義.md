# 商機對象(NewOpportunityObj)欄位定義

## 對象資訊
- **API名稱**: `NewOpportunityObj`
- **顯示名稱**: 商機
- **類型**: 預設對象（有自定義欄位）
- **總欄位數**: 61個（系統欄位52個，自定義欄位9個）

## 核心系統欄位

| 欄位名稱 | API名稱 | 資料類型 | 說明 | 範例值 |
|---------|---------|---------|------|--------|
| ID | _id | string | 記錄唯一標識 | "650c09e8dc044f0001973eab" |
| 商機名稱 | name | string | 商機名稱 | "勝美-育賢二-2023" |
| 商機金額 | amount | string | 商機金額 | "21739535.00" |
| 預計成交日期 | close_date | number | 時間戳 | 1690214400000 |
| 客戶名稱 | account_id | string | 客戶ID | "6508f92086a6c8000190db97" |
| 客戶名稱顯示 | account_id__r | string | 客戶顯示名稱 | "勝美建設股份有限公司" |
| 商機階段 | sales_stage | string | 階段代碼 | "5" |
| 商機階段顯示 | sales_stage__r | string | 階段名稱 | "贏單" |
| 階段狀態 | sales_status | string | 狀態代碼 | "2" |
| 階段狀態顯示 | sales_status__r | string | 狀態名稱 | "赢单" |
| 赢率 | probability | number | 百分比 | 100 |
| 預測金額 | probability_amount | string | 計算欄位 | "21739535.00" |
| 銷售流程 | sales_process_id | string | 流程ID | "64ec36f86815cf000178aec1" |
| 銷售流程顯示 | sales_process_id__r | string | 流程名稱 | "建案销售流程" |
| 負責人 | owner | array | 負責人ID陣列 | ["FSUID_F8E5C73533927249281F06800BC975AA"] |
| 負責人資訊 | owner__r | object | 負責人詳細資訊 | {name: "賴俊穎"} |
| 負責人部門ID | owner_department_id | string | 部門ID | "1003" |
| 負責人部門 | owner_department | string | 部門名稱 | "管理部" |
| 整單折扣 | opp_discount | number | 百分比 | 100 |
| 產品合計 | opp_lines_sum | string | 統計欄位 | "2096080100.00" |
| 相關團隊 | relevant_team | array | 團隊成員設定 | [{teamMemberRole: "1"}] |
| 創建時間 | create_time | number | 時間戳 | 1695287785275 |
| 最後修改時間 | last_modified_time | number | 時間戳 | 1754092250913 |
| 最後跟進時間 | last_followed_time | number | 時間戳 | 1754092250373 |
| 階段變更時間 | stg_changed_time | number | 時間戳 | 1697185975802 |
| 結單週期 | cost_time | string | 計算欄位 | "1898208000" |
| 鎖定狀態 | lock_status | string | 0=未鎖定 | "0" |
| 生命狀態 | life_status | string | 記錄狀態 | "normal" |
| 當前階段索引 | currentStageIndex | number | 階段位置 | 5 |
| 總階段數 | totalStageCount | number | 階段總數 | 5 |

## 自定義欄位（依CSV對照）

| 欄位名稱 | API名稱 | 資料類型 | 說明 | 範例值 |
|---------|---------|---------|------|--------|
| 工地名或案場名 | field_rU4l5__c | string | 工地/案場名稱 | "勝美-育賢二期" |
| 需求描述 | field_SdEgv__c | string | 多行文本 | "磁磚及SPC" |
| 案場地址或地段 | field_nI1xS__c | string | 地址資訊 | "台中市太平區旱溪東路二段、太順路" |
| 商機可能性 | field_lmjjf__c | string | 選項代碼 | "TvP3c4kMA" |
| 商機可能性顯示 | field_lmjjf__c__r | string | 選項顯示 | "高" |
| 實體層或樣品屋 | field_UJ7fD__c | string | 選項代碼 | "z1Dt429HO" |
| 實體層或樣品屋顯示 | field_UJ7fD__c__r | string | 選項顯示 | "實體層" |
| 浴室(地)坪數 | field_e8m3q__c | string | 計算欄位 | "0" |
| 浴室(壁)坪數 | field_vE1Zn__c | string | 計算欄位 | "0" |
| 室內坪數 | field_5co25__c | string | 計算欄位 | "0" |
| 二丁掛數量(萬) | field_i32Uj__c | string | 計算欄位 | "0" |

## CSV文件中定義但未在範例中出現的欄位

根據CSV文件，以下欄位也屬於商機對象，但在查詢範例中未出現：

| 欄位名稱 | API名稱 | 欄位類型 | 是否必填 |
|---------|---------|---------|---------|
| 預計拆架日 | field_n4qm3__c | 日期 | 否 |
| GMAP定位 | field_3e2B2__c | 网址 | 否 |
| 維修管理表 | field_g927h__c | 网址 | 否 |
| 客户是否确认报价 | field_3NRfq__c | 单选 | 否 |
| 開工日期 | field_Kt4Pg__c | 日期 | 否 |
| 舖土面日期 | field_11xou__c | 日期 | 否 |
| 總戶數 | field_hh49z__c | 数字 | 否 |
| 建案名稱 | field_bgi37__c | 单行文本 | 否 |
| 頂樓完成日 | field_IZys1__c | 日期 | 否 |
| 預計簽約季度 | field_Rd32h__c | 单行文本 | 是 |
| 案場備註 | field_2zhjh__c | 多行文本 | 否 |
| 地上層數 | field_zO24t__c | 数字 | 否 |
| 施工管理表 | field_0t3OP__c | 网址 | 否 |
| 缺失追蹤表 | field_ncsUJ__c | 网址 | 否 |
| 棟數 | field_Mrn1l__c | 数字 | 否 |
| 浴室間數 | field_mNxa4__c | 数字 | 否 |
| 認列比例 | field_DlN6M__c | 单行文本 | 否 |
| 預計交屋日期 | field_Mss6d__c | 日期 | 否 |
| 3房戶數 | field_iPvRk__c | 数字 | 否 |
| 實體層或樣品屋日期 | field_zYRAu__c | 日期 | 否 |
| 地下層數 | field_30rKQ__c | 数字 | 否 |
| 1房戶數 | field_0oEz1__c | 数字 | 否 |
| 2房戶數 | field_ax2Bf__c | 数字 | 否 |
| 4房戶數 | field_w04Lk__c | 数字 | 否 |

## 資料同步注意事項

### 1. 資料類型映射

```sql
-- D1資料表建議結構
CREATE TABLE newopportunityobj (
  _id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  amount TEXT,
  close_date INTEGER NOT NULL,
  account_id TEXT NOT NULL,
  account_id__r TEXT,
  sales_stage TEXT NOT NULL,
  sales_stage__r TEXT,
  sales_status TEXT,
  sales_status__r TEXT,
  sales_process_id TEXT NOT NULL,
  sales_process_id__r TEXT,
  probability INTEGER,
  probability_amount TEXT,
  owner TEXT,
  owner__r TEXT,
  owner_department_id TEXT,
  owner_department TEXT,
  opp_discount INTEGER,
  opp_lines_sum TEXT,
  create_time INTEGER,
  last_modified_time INTEGER,
  last_followed_time INTEGER,
  stg_changed_time INTEGER,
  cost_time TEXT,
  lock_status TEXT,
  life_status TEXT,
  is_deleted BOOLEAN DEFAULT FALSE,
  
  -- 自定義欄位
  field_rU4l5__c TEXT,        -- 工地名或案場名
  field_SdEgv__c TEXT,        -- 需求描述
  field_nI1xS__c TEXT,        -- 案場地址或地段
  field_lmjjf__c TEXT,        -- 商機可能性
  field_lmjjf__c__r TEXT,     -- 商機可能性顯示
  field_UJ7fD__c TEXT,        -- 實體層或樣品屋
  field_UJ7fD__c__r TEXT,     -- 實體層或樣品屋顯示
  field_n4qm3__c INTEGER,     -- 預計拆架日
  field_3e2B2__c TEXT,        -- GMAP定位
  field_g927h__c TEXT,        -- 維修管理表
  field_3NRfq__c TEXT,        -- 客户是否确认报价
  field_Kt4Pg__c INTEGER,     -- 開工日期
  field_11xou__c INTEGER,     -- 舖土面日期
  field_hh49z__c INTEGER,     -- 總戶數
  field_bgi37__c TEXT,        -- 建案名稱
  field_IZys1__c INTEGER,     -- 頂樓完成日
  field_Rd32h__c TEXT,        -- 預計簽約季度
  field_2zhjh__c TEXT,        -- 案場備註
  field_zO24t__c INTEGER,     -- 地上層數
  field_0t3OP__c TEXT,        -- 施工管理表
  field_ncsUJ__c TEXT,        -- 缺失追蹤表
  field_Mrn1l__c INTEGER,     -- 棟數
  field_mNxa4__c INTEGER,     -- 浴室間數
  field_DlN6M__c TEXT,        -- 認列比例
  field_Mss6d__c INTEGER,     -- 預計交屋日期
  field_iPvRk__c INTEGER,     -- 3房戶數
  field_zYRAu__c INTEGER,     -- 實體層或樣品屋日期
  field_30rKQ__c INTEGER,     -- 地下層數
  field_0oEz1__c INTEGER,     -- 1房戶數
  field_ax2Bf__c INTEGER,     -- 2房戶數
  field_w04Lk__c INTEGER,     -- 4房戶數
  field_e8m3q__c TEXT,        -- 浴室(地)坪數
  field_vE1Zn__c TEXT,        -- 浴室(壁)坪數
  field_5co25__c TEXT,        -- 室內坪數
  field_i32Uj__c TEXT,        -- 二丁掛數量(萬)
  
  -- 同步控制欄位
  sync_version INTEGER DEFAULT 0,
  fx_created_at INTEGER,
  fx_updated_at INTEGER
);
```

### 2. 關鍵處理邏輯

1. **陣列欄位處理**
   - owner、created_by、last_modified_by 等陣列欄位需要取第一個元素
   - relevant_team 需要JSON序列化儲存

2. **日期欄位處理**
   - 所有日期欄位使用Unix時間戳（毫秒）
   - 顯示時需要轉換為本地時間

3. **關聯欄位處理**
   - account_id 存儲實際ID
   - account_id__r 存儲顯示名稱
   - 避免額外的關聯查詢

4. **必填欄位**
   - name（商機名稱）
   - close_date（預計成交日期）
   - account_id（客戶名稱）
   - sales_stage（商機階段）
   - sales_process_id（銷售流程）
   - field_SdEgv__c（需求描述）
   - field_lmjjf__c（商機可能性）
   - field_Rd32h__c（預計簽約季度）

### 3. 商機與案場的關聯

商機對象中的 `field_rU4l5__c`（工地名或案場名）可能與案場對象有關聯，需要在同步時建立對應關係。